const x={compactWidth:!1,windowAction:"none",selectAfterImport:"auto",customizeDrop:!1,dropToFrame:!0,v3Notice:!1},h=Object.assign({},x);function B(e){var o;h.v3Notice=!0;const t=["compactWidth","windowAction","selectAfterImport","customizeDrop","dropToFrame"];for(const n of t){const i=(o=e.options)==null?void 0:o[n];i!==void 0&&(h[n]=i)}return h}async function K(){try{const e=await figma.clientStorage.getAsync("config");switch(e==null?void 0:e.version){case 2:B(e);break;case 3:Object.assign(h,e);break}}catch(e){}return h}function Y(){const e={version:3};let t;for(t in x){const o=h[t],n=x[t];n!==void 0&&n!==o&&(e[t]=o)}figma.clientStorage.setAsync("config",e).catch()}function X(){const e=figma;try{const t=e.editorType;switch(t){case"figma":case"figjam":return t}}catch(t){console.error(t)}try{if(typeof e.createSticky=="function")return"figjam"}catch(t){console.error(t)}return"figma"}const g={app:X(),loaded:!1,minimized:!1,config:h};function b(){const e=g.app;return e==="figjam"?"FigJam":e.slice(0,1).toUpperCase()+e.slice(1)}const P={mini:{width:200,height:104},full:{width:480,min:460,max:720},compact:{width:352,min:400,max:600},innerDiff:90,outerDiff:150};function D(){const e=g.config.compactWidth,t=P[e?"compact":"full"];let o;if(g.windowInnerHeight){const n=g.windowOuterHeight?g.windowOuterHeight-P.outerDiff:g.windowInnerHeight-P.innerDiff;o=Math.max(Math.min(n,t.max),t.min)}else o=t.max;return console.log("Setting window height to:",o),{width:t.width,height:o}}function N(e){figma.ui.postMessage(e)}function L(e){switch(e.type){case"PAGE":case"COMPONENT":case"FRAME":case"SECTION":case"GROUP":return e}}function q(e){switch(e.type){case"FRAME":case"COMPONENT":return e}}function Q(e){function t(){if(e.getSharedPluginData("iconify","source")==="iconify"){const n=JSON.parse(e.getSharedPluginData("iconify","props")),c=n.name.split(":");if(c.length===2)switch(n.version){case 3:return n;default:{const r=n.props;let s;return typeof n.color=="string"?s=n.color:typeof r=="object"&&(s=r.color),{version:3,name:n.name,color:s,route:{type:"icon-set",prefix:c[0],parent:{type:"icon-sets"}}}}}}}try{return t()}catch(o){}}function R(e){return{nodes:e.nodes||Object.create(null),ignoreIconNode:e.ignoreIconNode||!1,iconNodeID:e.iconNodeID||null,iconNodeData:e.iconNodeData||null}}function E(e,t,o){function n(i,c,r){const s=i.id,f=t.nodes[s];if(f)return r&&f.children.push(r),f;let l="invalid",d=!1,u,w;const p=q(i);p&&(u=Q(p),u&&(w=p.height,t.iconNodeID?t.ignoreIconNode=!0:(t.iconNodeID=s,t.iconNodeData=u)));const a=L(i);a?a.type==="PAGE"?(l="valid",d=!0):(a.locked||(l="valid"),(!c||a.locked)&&(t.ignoreIconNode=!0),d=a.type!=="FRAME"):i.type==="COMPONENT_SET"?l="ignored":t.ignoreIconNode=!0;const m={type:i.type,id:s,name:i.name,target:l,children:r?[r]:[],primary:c,relative:d,icon:u,height:w};return t.nodes[s]=m,i.parent&&i.type!=="PAGE"&&n(i.parent,c,i.id),m}return n(e,o)}const Z=16;function W(){const e=figma.currentPage,t=e.selection,o=R({}),n=E(e,o,!1);t.forEach((a,m)=>{E(a,o,!m)});const{nodes:i,iconNodeData:c,iconNodeID:r,ignoreIconNode:s}=o,f=[];let l=n.id,d;function u(a,m=0){switch(a.target){case"ignored":{a.children.forEach(I=>{u(i[I],m)});break}case"valid":switch(a.type){case"PAGE":case"COMPONENT":case"FRAME":case"SECTION":case"GROUP":const I={id:a.id,name:a.name,depth:m,type:a.type};!s&&c&&r===a.id&&(I.icon=c,I.height=a.height,d=I),a.icon||(f.push(I),a.primary&&!a.icon&&(l=a.id),a.children.forEach(_=>{u(i[_],m+1)}))}}}u(n);let w=!1,p=Z;for(;f.length>p;)f.pop()===d&&(w=!0,p--);return w&&d&&f.push(d),{nodes:f,defaultNode:l,iconNode:d}}let G=W();function z(){return G}function ee(e){G=e}let O=!1;function te(){const e=W();JSON.stringify(e)!==JSON.stringify(z())&&(ee(e),N({type:"plugin:nodes",nodes:e}))}function v(){O||(O=!0,setTimeout(()=>{O=!1,te()},250))}async function T(e,t,o){try{const n=await figma.clientStorage.getAsync(e);if(n)return o?o(n):n}catch(n){}return t}function k(e,t){figma.clientStorage.setAsync(e,t).catch()}const U="recent";let y=[];const ne=64;async function ie(){const e=await T(U,void 0);return e&&(y=e),e}let S=!1;function oe(){S||(S=!0,setTimeout(()=>{S=!1,k(U,y),N({type:"plugin:recent-icons",icons:y})},1e3))}function j(e){for(const t of e){const o=y.indexOf(t);o!==-1&&y.splice(o,1),y.unshift(t),y.length>ne&&y.pop(),oe()}}const ce={replace:"Replace icon",code:"Icon code"};function V(e,t,o,n){e.name=t,e.setSharedPluginData("iconify","source","iconify");const i={version:3,name:t,props:o,route:n};e.setSharedPluginData("iconify","props",JSON.stringify(i)),e.setRelaunchData(ce)}function $(e,t){const o=figma.createNodeFromSvg(e);let n;if(t.replace?n=t.replace:t.component&&(n=figma.createComponent()),n){for(;n.children.length>0;)n.children[0].remove();n.resizeWithoutConstraints(o.width,o.height);for(const c of o.children)n.appendChild(c);if(o.remove(),t.replace)return n}const i=n||o;if(t.parent){const c=t.parent;let r=!0;const s=c.layoutMode;s&&s!=="NONE"&&(r=!1),r?c.appendChild(i):c.insertChild(0,i),t.x&&(i.x=t.x),t.y&&(i.y=t.y)}return i.constrainProportions=!0,i}function M(e,t,o,n){if(e.type==="PAGE")return t;let i=0,c=n?e.width:e.height;if(e.type==="GROUP"&&(i=n?e.x:e.y),t<i)return i;const r=i+c-o;return t>r?Math.max(i,r):t}function J(e,t,o){const n=t.icons.reduce((r,s)=>r+Math.ceil(s.width),0);let i=M(e,Math.round(o.targetX-n/2),n,!0);const c=[];for(const r of t.icons){const s=M(e,Math.round(o.targetY-r.height/2),r.height,!1),f=$(r.content,{parent:e,x:i,y:s,component:o.component});V(f,r.name,t.props,t.route),i+=Math.ceil(r.width),c.push(f)}j(Object.keys(t.icons)),N({type:"plugin:notice",color:"success",text:`Imported ${t.icons.length>1?t.icons.length+" icons":t.icons[0].name} to ${b()}`}),figma.currentPage.selection=c,v()}function A(){N({type:"plugin:notice",color:"error",text:"Error dropping icon(s) to "+b()})}function re(e){let t=e.x,o=e.y;const n=e.node;n.type==="GROUP"&&(t+=n.x,o+=n.y);const i=R({});E(n,i,!0);const c=i.nodes[figma.currentPage.id];if(!c){console.error("Cannot find current page item in scanned nodes list"),A();return}let r=0,s=0,f=!0,l=c,d=c;for(;l.children.length;){const w=l.children[0];if(l=i.nodes[w],l.icon||l.target==="invalid"?f=!1:f&&l.target==="valid"&&(d=l),!f&&l.relative){const p=figma.getNodeById(l.id);p&&(r+=p.x||0,s+=p.y||0)}}const u=figma.getNodeById(d.id);if(!u){console.error("Failed to get target node"),A();return}J(u,e.dropMetadata,{targetX:r+t,targetY:s+o})}function C(){N({type:"plugin:notice",color:"error",text:"Error importing icon(s) to "+b()})}function ae(e,t){const o=figma.getNodeById(e);if(!o){C();return}const n=o.name;for(const i of t.icons){const c=i.name,r=$(i.content,{replace:o,x:o.x,y:o.y});V(r,c,t.props,t.route),j([c]),N({type:"plugin:notice",color:"success",text:`Replaced ${n} with ${c}`}),figma.currentPage.selection=[r],v();return}C()}function se(e,t,o){const n=figma.getNodeById(e);if(!n){C();return}let i,c;switch(n.type){case"PAGE":{const r=figma.viewport.center;i=r.x,c=r.y;break}case"GROUP":{i=n.x+n.width/2,c=n.y+n.height/2;break}default:{i=n.width/2,c=n.height/2;break}}J(n,t,{component:o,targetX:i,targetY:c})}const H="icon-sets",F="route-v3";(async()=>{console.log("Starting plugin..."),await K();const e=await T(H,void 0,i=>i.version===3?i.data:void 0),t=await T(F,void 0),o=await ie();figma.on("selectionchange",v),figma.on("currentpagechange",v),figma.on("drop",re),figma.ui.onmessage=i=>{try{if(typeof i.type!="string")return}catch(r){console.error(r)}const c=i;switch(console.log("Got event from UI:",c),c.type){case"ui:fatal-error":{figma.closePlugin(c.error);break}case"ui:loaded":{if(c.innerHeight||c.outerHeight){g.windowInnerHeight=c.innerHeight,g.windowOuterHeight=c.outerHeight;const r=D();r.height!==g.lastWindowHeight&&(g.lastWindowHeight=r.height,figma.ui.resize(r.width,r.height))}N({type:"plugin:starting",app:g.app,command:figma.command,config:h,nodes:z(),lists:e,recent:o,route:t});break}case"ui:close":{figma.closePlugin();break}case"ui:compact":{h.compactWidth=!h.compactWidth;const r=D();r.height!==g.lastWindowHeight&&(g.lastWindowHeight=r.height,figma.ui.resize(r.width,r.height)),N({type:"plugin:resize",compactWidth:h.compactWidth,minimized:!1}),Y();break}case"ui:lists":{const r={version:3,data:c.lists};k(H,r);break}case"ui:route":{k(F,c.route);break}case"ui:replace-icon":{ae(c.node,c.data);break}case"ui:import-icons":{se(c.node,c.data,c.component||!1);break}}};const n=D();g.lastWindowHeight=n.height,figma.showUI(__html__,Object.assign({themeColors:!1},n))})();
