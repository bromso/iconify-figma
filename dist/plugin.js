const b={compactWidth:!1,windowAction:"none",selectAfterImport:"auto",customizeDrop:!1,dropToFrame:!0,v3Notice:!1},h=Object.assign({},b);function ee(e){var o;h.v3Notice=!0;const t=["compactWidth","windowAction","selectAfterImport","customizeDrop","dropToFrame"];for(const n of t){const i=(o=e.options)==null?void 0:o[n];i!==void 0&&(h[n]=i)}return h}async function te(){try{const e=await figma.clientStorage.getAsync("config");switch(e==null?void 0:e.version){case 2:ee(e);break;case 3:Object.assign(h,e);break}}catch(e){}return h}function ne(){const e={version:3};let t;for(t in b){const o=h[t],n=b[t];n!==void 0&&n!==o&&(e[t]=o)}figma.clientStorage.setAsync("config",e).catch()}function oe(){const e=figma;try{const t=e.editorType;switch(t){case"figma":case"figjam":return t}}catch(t){console.error(t)}try{if(typeof e.createSticky=="function")return"figjam"}catch(t){console.error(t)}return"figma"}const u={app:oe(),loaded:!1,minimized:!1,config:h};function C(){const e=u.app;return e==="figjam"?"FigJam":e.slice(0,1).toUpperCase()+e.slice(1)}const O={mini:{width:200,height:104},full:{width:480,min:580,max:720},compact:{width:352,min:520,max:640},innerDiff:90,outerDiff:150};function D(){const e=u.config.compactWidth,t=O[e?"compact":"full"];let o;if(u.windowInnerHeight){const n=u.windowOuterHeight?u.windowOuterHeight-O.outerDiff:u.windowInnerHeight-O.innerDiff;o=Math.max(Math.min(n,t.max),t.min)}else o=t.max;return console.log("Setting window height to:",o),{width:t.width,height:o}}function m(e){figma.ui.postMessage(e)}function ie(e){switch(e.type){case"PAGE":case"COMPONENT":case"FRAME":case"SECTION":case"GROUP":return e}}function ce(e){switch(e.type){case"FRAME":case"COMPONENT":return e}}function re(e){function t(){if(e.getSharedPluginData("iconify","source")==="iconify"){const n=JSON.parse(e.getSharedPluginData("iconify","props")),c=n.name.split(":");if(c.length===2)switch(n.version){case 3:return n;default:{const r=n.props;let s;return typeof n.color=="string"?s=n.color:typeof r=="object"&&(s=r.color),{version:3,name:n.name,color:s,route:{type:"icon-set",prefix:c[0],parent:{type:"icon-sets"}}}}}}}try{return t()}catch(o){}}function U(e){return{nodes:e.nodes||Object.create(null),ignoreIconNode:e.ignoreIconNode||!1,iconNodeID:e.iconNodeID||null,iconNodeData:e.iconNodeData||null}}function A(e,t,o){function n(i,c,r){const s=i.id,l=t.nodes[s];if(l)return r&&l.children.push(r),l;let a="invalid",f=!1,g,w;const p=ce(i);p&&(g=re(p),g&&(w=p.height,t.iconNodeID?t.ignoreIconNode=!0:(t.iconNodeID=s,t.iconNodeData=g)));const d=ie(i);d?d.type==="PAGE"?(a="valid",f=!0):(d.locked||(a="valid"),(!c||d.locked)&&(t.ignoreIconNode=!0),f=d.type!=="FRAME"):i.type==="COMPONENT_SET"?a="ignored":t.ignoreIconNode=!0;const y={type:i.type,id:s,name:i.name,target:a,children:r?[r]:[],primary:c,relative:f,icon:g,height:w};return t.nodes[s]=y,i.parent&&i.type!=="PAGE"&&n(i.parent,c,i.id),y}return n(e,o)}const se=16;function j(){const e=figma.currentPage,t=e.selection,o=U({}),n=A(e,o,!1);t.forEach((d,y)=>{A(d,o,!y)});const{nodes:i,iconNodeData:c,iconNodeID:r,ignoreIconNode:s}=o,l=[];let a=n.id,f;function g(d,y=0){switch(d.target){case"ignored":{d.children.forEach(I=>{g(i[I],y)});break}case"valid":switch(d.type){case"PAGE":case"COMPONENT":case"FRAME":case"SECTION":case"GROUP":const I={id:d.id,name:d.name,depth:y,type:d.type};!s&&c&&r===d.id&&(I.icon=c,I.height=d.height,f=I),d.icon||(l.push(I),d.primary&&!d.icon&&(a=d.id),d.children.forEach(Z=>{g(i[Z],y+1)}))}}}g(n);let w=!1,p=se;for(;l.length>p;)l.pop()===f&&(w=!0,p--);return w&&f&&l.push(f),{nodes:l,defaultNode:a,iconNode:f}}let V=j();function $(){return V}function ae(e){V=e}function F(e){return e.type==="SOLID"&&e.visible!==!1&&e.blendMode==="NORMAL"&&e.opacity===1}function k(e){return e.paints.length!==1?!1:F(e.paints[0])}function B(e){const t=figma.getStyleById(e);if((t==null?void 0:t.type)==="PAINT"&&k(t))return t.id}const M=new Set;function J(e){const t=e.paints[0].color;function o(i){const c=Math.round(i*255).toString(16);return c.length<2?"0"+c:c}const n="#"+o(t.r)+o(t.g)+o(t.b);return{id:e.id,name:e.name,color:n,remote:e.remote}}async function le(){const e=[];return(await figma.getLocalPaintStylesAsync()).forEach(t=>{try{M.add(t.id),k(t)&&e.push(J(t))}catch(o){console.log("Error parsing color style:",o)}}),e}function K(){const e=figma.getSelectionColors(),t=[];return e==null||e.styles.forEach(o=>{const n=o.id;M.has(n)||(M.add(n),k(o)&&t.push(J(o)))}),t.length?t:void 0}let E=!1;function fe(){const e=j();if(JSON.stringify(e)!==JSON.stringify($())){ae(e);const t=K();m({type:"plugin:nodes",nodes:e,styles:t})}}function v(){E||(E=!0,setTimeout(()=>{E=!1,fe()},250))}async function S(e,t,o){try{const n=await figma.clientStorage.getAsync(e);if(n)return o?o(n):n}catch(n){}return t}function P(e,t){figma.clientStorage.setAsync(e,t).catch()}const L="recent";let N=[];const ge=64;async function de(){const e=await S(L,void 0);return e&&(N=e),e}let x=!1;function ue(){x||(x=!0,setTimeout(()=>{x=!1,P(L,N),m({type:"plugin:recent-icons",icons:N})},1e3))}function _(e){for(const t of e){const o=N.indexOf(t);o!==-1&&N.splice(o,1),N.unshift(t),N.length>ge&&N.pop(),ue()}}const he={replace:"Replace icon",code:"Icon code"};function Y(e,t,o,n){e.name=t,e.setSharedPluginData("iconify","source","iconify");const i={version:3,name:t,props:o,route:n};e.setSharedPluginData("iconify","props",JSON.stringify(i)),e.setRelaunchData(he)}function X(e,t){const o=figma.createNodeFromSvg(e);let n;if(t.replace?n=t.replace:t.component&&(n=figma.createComponent()),n){for(;n.children.length>0;)n.children[0].remove();n.resizeWithoutConstraints(o.width,o.height);for(const c of o.children)n.appendChild(c);if(o.remove(),t.replace)return n}const i=n||o;if(t.parent){const c=t.parent;let r=!0;const s=c.layoutMode;s&&s!=="NONE"&&(r=!1),r?c.appendChild(i):c.insertChild(0,i),t.x&&(i.x=t.x),t.y&&(i.y=t.y)}return i.constrainProportions=!0,i}function H(e,t,o,n){if(e.type==="PAGE")return t;let i=0,c=n?e.width:e.height;if(e.type==="GROUP"&&(i=n?e.x:e.y),t<i)return i;const r=i+c-o;return t>r?Math.max(i,r):t}async function q(e,t){function o(c){try{if(c.length===1){const r=c[0];if(F(c[0]))return!0}}catch(r){}}async function n(c){o(c.fills)&&(typeof t=="string"?await c.setFillStyleIdAsync(t):c.fills=[t]),o(c.strokes)&&(typeof t=="string"?await c.setStrokeStyleIdAsync(t):c.strokes=[t])}async function i(c){const r=c;if(r.locked||r.isMask)return;try{await n(r)}catch(l){}const s=c.children;if(s)for(const l of s)await i(l)}for(const c of e.children)await i(c)}function Q(e,t,o){const n=t.icons.reduce((s,l)=>s+Math.ceil(l.width),0);let i=H(e,Math.round(o.targetX-n/2),n,!0),c;t.props.style&&(c=B(t.props.style));const r=[];for(const s of t.icons){const l=H(e,Math.round(o.targetY-s.height/2),s.height,!1),a=X(s.content,{parent:e,x:i,y:l,component:o.component});Y(a,s.name,t.props,t.route),i+=Math.ceil(s.width),r.push(a),s.monotone&&c&&q(a,c).catch(console.error)}return _(Object.keys(t.icons)),m({type:"plugin:notice",color:"success",text:`Imported ${t.icons.length>1?t.icons.length+" icons":t.icons[0].name} to ${C()}`}),figma.currentPage.selection=r,v(),r}function R(){m({type:"plugin:notice",color:"error",text:"Error dropping icon(s) to "+C()})}function pe(e){let t=e.x,o=e.y;const n=e.node;n.type==="GROUP"&&(t+=n.x,o+=n.y);const i=U({});A(n,i,!0);const c=i.nodes[figma.currentPage.id];if(!c){console.error("Cannot find current page item in scanned nodes list"),R();return}let r=0,s=0,l=!0,a=c,f=c;for(;a.children.length;){const w=a.children[0];if(a=i.nodes[w],a.icon||a.target==="invalid"?l=!1:l&&a.target==="valid"&&(f=a),!l&&a.relative){const p=figma.getNodeById(a.id);p&&(r+=p.x||0,s+=p.y||0)}}const g=figma.getNodeById(f.id);if(!g){console.error("Failed to get target node"),R();return}Q(g,e.dropMetadata,{targetX:r+t,targetY:s+o})}function T(){m({type:"plugin:notice",color:"error",text:"Error importing icon(s) to "+C()})}function me(e,t){const o=figma.getNodeById(e);if(!o){T();return}const n=o.name;let i;const c=figma.currentPage.selection;if(c.length===1&&c[0].id===o.id){const r=figma.getSelectionColors();if(r){const s=r.paints,l=r.styles;s.length+l.length===1?(l.length&&k(l[0])&&(i=l[0].id),s.length&&F(s[0])&&(i=s[0])):t.props.style&&(i=B(t.props.style))}}for(const r of t.icons){const s=r.name,l=X(r.content,{replace:o,x:o.x,y:o.y});Y(l,s,t.props,t.route),_([s]),m({type:"plugin:notice",color:"success",text:`Replaced ${n} with ${s}`}),figma.currentPage.selection=[l],v(),r.monotone&&i&&q(l,i).catch(console.error);return}T()}function ye(e,t,o){const n=figma.getNodeById(e);if(!n){T();return}let i,c;switch(n.type){case"PAGE":{const r=figma.viewport.center;i=r.x,c=r.y;break}case"GROUP":{i=n.x+n.width/2,c=n.y+n.height/2;break}default:{i=n.width/2,c=n.height/2;break}}Q(n,t,{component:o,targetX:i,targetY:c})}const W="icon-sets",G="route-v3",z="icon-sets-filters";(async()=>{var l;console.log("Starting plugin..."),await te();const e=await S(W,void 0,a=>a.version===3?a.data:void 0);let t=await S(G,void 0);const o=await de(),n=await S(z,void 0),i=$(),c=K();let r;if(figma.command==="replace"){const a=(l=i.iconNode)==null?void 0:l.icon;a!=null&&a.route&&(t=a.route,r=a.name)}figma.on("selectionchange",v),figma.on("currentpagechange",v),figma.on("drop",pe),figma.ui.onmessage=a=>{try{if(typeof a.type!="string")return}catch(g){console.error(g)}const f=a;switch(console.log("Got event from UI:",f),f.type){case"ui:fatal-error":{figma.closePlugin(f.error);break}case"ui:loaded":{if(f.innerHeight||f.outerHeight){u.windowInnerHeight=f.innerHeight,u.windowOuterHeight=f.outerHeight;const g=D();g.height!==u.lastWindowHeight&&(u.lastWindowHeight=g.height,figma.ui.resize(g.width,g.height))}m({type:"plugin:starting",app:u.app,command:figma.command,config:h,nodes:i,styles:c,lists:e,recent:o,route:t,filters:n,selectIcon:r}),le().then(g=>{g.length&&m({type:"plugin:color-styles",styles:g})}).catch(console.error);break}case"ui:close":{figma.closePlugin();break}case"ui:compact":{h.compactWidth=!h.compactWidth;const g=D();g.height!==u.lastWindowHeight&&(u.lastWindowHeight=g.height,figma.ui.resize(g.width,g.height)),m({type:"plugin:resize",compactWidth:h.compactWidth,minimized:!1}),ne();break}case"ui:lists":{const g={version:3,data:f.lists};P(W,g);break}case"ui:route":{P(G,f.route);break}case"ui:filters":{P(z,f.filters);break}case"ui:replace-icon":{me(f.node,f.data);break}case"ui:import-icons":{ye(f.node,f.data,f.component||!1);break}}};const s=D();u.lastWindowHeight=s.height,figma.showUI(__html__,Object.assign({themeColors:!1},s))})();
